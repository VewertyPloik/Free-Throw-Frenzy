<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fishing Game with Exotic Rarity & Updated Lures</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #a0d8ef;
      margin: 0; padding: 20px;
      text-align: center;
    }
    #game {
      max-width: 500px;
      margin: auto;
      background: #d0f0f0;
      border-radius: 10px;
      padding: 20px;
    }
    #slideBar {
      position: relative;
      height: 30px;
      background: #ddd;
      margin: 20px 0;
      border-radius: 15px;
      cursor: pointer;
    }
    #redZone {
      position: absolute;
      left: 40%;
      width: 20%;
      top: 0;
      height: 100%;
      background: #ff4c4c;
      border-radius: 15px;
    }
    #greenArrow {
      position: absolute;
      top: 0;
      width: 15px;
      height: 30px;
      background: #4caf50;
      border-radius: 5px;
    }
    button {
      font-size: 16px;
      padding: 10px 20px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      background: #0077cc;
      color: white;
      margin: 5px;
    }
    button:disabled {
      background: #999;
      cursor: not-allowed;
    }
    #info, #coins, #shop, #caughtFish, #currentLureDisplay {
      margin-top: 15px;
    }
    #shop button {
      margin: 5px;
    }
    #caughtFish {
      font-weight: bold;
      min-height: 80px;
    }
    #libraryBtn {
      background: #004a99;
    }
    #library {
      display: none;
      background: #f0f8ff;
      border-radius: 10px;
      padding: 10px;
      max-height: 320px;
      overflow-y: auto;
      margin-top: 15px;
      text-align: left;
    }
    #library h2 {
      text-align: center;
      margin: 0 0 10px 0;
    }
    #libraryCount {
      text-align: center;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .fishEntry {
      padding: 5px;
      border-bottom: 1px solid #ccc;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .fishEntry.locked {
      color: #aaa;
      font-style: italic;
    }
    .rarity1 { color: #555; }      /* Common - gray */
    .rarity2 { color: #007700; }   /* Uncommon - green */
    .rarity3 { color: #0000cc; }   /* Rare - blue */
    .rarity4 { color: #aa00aa; }   /* Epic - purple */
    .rarity5 { color: #cc9900; }   /* Legendary - gold */
    .rarity6 { color: #ff6600; }   /* Exotic - orange */
  </style>
</head>
<body>
  <div id="game">
    <h1>Fishing Game</h1>
    <div id="coins">Coins: 0</div>
    <div id="currentLureDisplay">Current Lure: Basic Lure (Common & Uncommon only)</div>
    <button id="castBtn">Cast Line</button>
    <button id="libraryBtn">Show Fish Library</button>

    <div id="slideBar" style="display:none;">
      <div id="redZone"></div>
      <div id="greenArrow"></div>
    </div>

    <div id="info"></div>

    <div id="caughtFish"></div>

    <h2>Shop - Buy & Select Lures</h2>
    <div id="shop"></div>

    <div id="library">
      <h2>Fish Library</h2>
      <div id="libraryCount"></div>
      <div id="fishList"></div>
    </div>
  </div>

<script>
  // 125 fish total, rarity 1-6 (exotic=6)
  const fishTypes = [
    // First 100 fish from before (shortened here for brevity, use previous 100 fish),
    {name: "Small Carp", rarity: 1, baseValue: 5},
    {name: "Bass", rarity: 2, baseValue: 10},
    {name: "Trout", rarity: 3, baseValue: 20},
    {name: "Salmon", rarity: 4, baseValue: 50},
    {name: "Golden Sturgeon", rarity: 5, baseValue: 100},
    {name: "Bluegill", rarity: 1, baseValue: 6},
    {name: "Catfish", rarity: 2, baseValue: 12},
    {name: "Rainbow Trout", rarity: 3, baseValue: 22},
    {name: "Chinook Salmon", rarity: 4, baseValue: 60},
    {name: "Megalodon Tooth", rarity: 5, baseValue: 120},
    {name: "Perch", rarity: 1, baseValue: 5},
    {name: "Walleye", rarity: 2, baseValue: 15},
    {name: "Steelhead", rarity: 3, baseValue: 25},
    {name: "Coho Salmon", rarity: 4, baseValue: 55},
    {name: "Dragonfish", rarity: 5, baseValue: 130},
    {name: "Sunfish", rarity: 1, baseValue: 7},
    {name: "Pike", rarity: 2, baseValue: 13},
    {name: "Lake Trout", rarity: 3, baseValue: 23},
    {name: "Sockeye Salmon", rarity: 4, baseValue: 58},
    {name: "Phoenix Carp", rarity: 5, baseValue: 140},
    {name: "Crappie", rarity: 1, baseValue: 5},
    {name: "Gar", rarity: 2, baseValue: 14},
    {name: "Arctic Char", rarity: 3, baseValue: 24},
    {name: "Pink Salmon", rarity: 4, baseValue: 52},
    {name: "Leviathan", rarity: 5, baseValue: 150},
    {name: "Shad", rarity: 1, baseValue: 6},
    {name: "Muskie", rarity: 2, baseValue: 16},
    {name: "Grayling", rarity: 3, baseValue: 26},
    {name: "Chum Salmon", rarity: 4, baseValue: 57},
    {name: "Kraken Tentacle", rarity: 5, baseValue: 160},
    {name: "Bluefish", rarity: 1, baseValue: 7},
    {name: "Tench", rarity: 2, baseValue: 15},
    {name: "Bull Trout", rarity: 3, baseValue: 25},
    {name: "Atlantic Salmon", rarity: 4, baseValue: 60},
    {name: "Sea Serpent", rarity: 5, baseValue: 170},
    {name: "Yellow Perch", rarity: 1, baseValue: 5},
    {name: "Zander", rarity: 2, baseValue: 14},
    {name: "Brook Trout", rarity: 3, baseValue: 23},
    {name: "King Salmon", rarity: 4, baseValue: 65},
    {name: "Hydra", rarity: 5, baseValue: 180},
    {name: "Tiny Minnow", rarity: 1, baseValue: 3},
    {name: "Golden Sunfish", rarity: 2, baseValue: 18},
    {name: "Silver Pike", rarity: 3, baseValue: 28},
    {name: "Emperor Trout", rarity: 4, baseValue: 70},
    {name: "Mythic Leviathan", rarity: 5, baseValue: 220},
    {name: "Striped Bass", rarity: 1, baseValue: 6},
    {name: "Electric Eel", rarity: 2, baseValue: 20},
    {name: "Shadow Catfish", rarity: 3, baseValue: 30},
    {name: "Glacial Salmon", rarity: 4, baseValue: 75},
    {name: "Celestial Dragonfish", rarity: 5, baseValue: 230},
    {name: "Luminous Carp", rarity: 1, baseValue: 7},
    {name: "Coral Grouper", rarity: 2, baseValue: 19},
    {name: "Emerald Trout", rarity: 3, baseValue: 32},
    {name: "Titan Salmon", rarity: 4, baseValue: 80},
    {name: "Ancient Kraken", rarity: 5, baseValue: 240},
    {name: "Diamond Perch", rarity: 1, baseValue: 6},
    {name: "Thunder Pike", rarity: 2, baseValue: 22},
    {name: "Phantom Steelhead", rarity: 3, baseValue: 35},
    {name: "Royal Coho Salmon", rarity: 4, baseValue: 85},
    {name: "Vortex Serpent", rarity: 5, baseValue: 250},
    {name: "Crescent Sunfish", rarity: 1, baseValue: 5},
    {name: "Jade Muskie", rarity: 2, baseValue: 21},
    {name: "Frost Grayling", rarity: 3, baseValue: 36},
    {name: "Inferno Chum Salmon", rarity: 4, baseValue: 90},
    {name: "Cosmic Hydra", rarity: 5, baseValue: 260},
    {name: "Moonlight Bluefish", rarity: 1, baseValue: 7},
    {name: "Storm Tench", rarity: 2, baseValue: 23},
    {name: "Crystal Bull Trout", rarity: 3, baseValue: 38},
    {name: "Sunset Atlantic Salmon", rarity: 4, baseValue: 95},
    {name: "Galactic Leviathan", rarity: 5, baseValue: 270},
    {name: "Sparkling Yellow Perch", rarity: 1, baseValue: 6},
    {name: "Obsidian Zander", rarity: 2, baseValue: 24},
    {name: "Ruby Brook Trout", rarity: 3, baseValue: 40},
    {name: "Diamond King Salmon", rarity: 4, baseValue: 100},
    {name: "Eternal Kraken", rarity: 5, baseValue: 280},
    {name: "Pearl Minnow", rarity: 1, baseValue: 4},
    {name: "Sapphire Sunfish", rarity: 2, baseValue: 25},
    {name: "Onyx Pike", rarity: 3, baseValue: 42},
    {name: "Thunder Emperor Trout", rarity: 4, baseValue: 105},
    {name: "Mythical Sea Serpent", rarity: 5, baseValue: 300},
    {name: "Glowing Striped Bass", rarity: 1, baseValue: 7},
    {name: "Electric Shadow Catfish", rarity: 2, baseValue: 26},
    {name: "Phantom Glacial Salmon", rarity: 3, baseValue: 45},
    {name: "Royal Celestial Dragonfish", rarity: 4, baseValue: 110},
    {name: "Legendary Cosmic Hydra", rarity: 5, baseValue: 320},

    // New 25 exotic rarity fish (rarity 6)
    {name: "Phoenix Featherfish", rarity: 6, baseValue: 400},
    {name: "Dragon Flamefin", rarity: 6, baseValue: 420},
    {name: "Celestial Moonfish", rarity: 6, baseValue: 430},
    {name: "Void Serpent", rarity: 6, baseValue: 450},
    {name: "Ethereal Leviathan", rarity: 6, baseValue: 460},
    {name: "Nebula Trout", rarity: 6, baseValue: 470},
    {name: "Galactic Ray", rarity: 6, baseValue: 480},
    {name: "Solar Flarefish", rarity: 6, baseValue: 490},
    {name: "Lunar Eclipse Carp", rarity: 6, baseValue: 500},
    {name: "Astral Pike", rarity: 6, baseValue: 510},
    {name: "Quantum Bass", rarity: 6, baseValue: 520},
    {name: "Infinity Catfish", rarity: 6, baseValue: 530},
    {name: "Stellar Salmon", rarity: 6, baseValue: 540},
    {name: "Comet Trout", rarity: 6, baseValue: 550},
    {name: "Cosmic Carp", rarity: 6, baseValue: 560},
    {name: "Meteor Minnow", rarity: 6, baseValue: 570},
    {name: "Radiant Sunfish", rarity: 6, baseValue: 580},
    {name: "Supernova Pike", rarity: 6, baseValue: 590},
    {name: "Gravity Walleye", rarity: 6, baseValue: 600},
    {name: "Photon Perch", rarity: 6, baseValue: 610},
    {name: "Dark Matter Trout", rarity: 6, baseValue: 620},
    {name: "Warp Speed Bass", rarity: 6, baseValue: 630},
    {name: "Plasma Catfish", rarity: 6, baseValue: 640},
    {name: "Hypernova Salmon", rarity: 6, baseValue: 650},
    {name: "Black Hole Serpent", rarity: 6, baseValue: 700}
  ];

  const rarityNames = ["Common", "Uncommon", "Rare", "Epic", "Legendary", "Exotic"];

  // Updated lures with new prices and max rarity catchable
  const lures = [
    {name: "Basic Lure", cost: 0, maxRarity: 2},        // Common & Uncommon
    {name: "Silver Spinner", cost: 10000, maxRarity: 3},  // up to Rare
    {name: "Golden Jig", cost: 100000, maxRarity: 6},     // up to Exotic
    {name: "Legendary Bait", cost: 150000, maxRarity: 5}  // up to Legendary (kept at 5 for variety)
  ];

  let coins = 0;
  let ownedLures = new Set([0]);
  let currentLureIndex = 0;

  let slideInterval;
  let greenArrow = document.getElementById("greenArrow");
  let slideBar = document.getElementById("slideBar");
  let castBtn = document.getElementById("castBtn");
  let info = document.getElementById("info");
  let coinsDisplay = document.getElementById("coins");
  let caughtFishDiv = document.getElementById("caughtFish");
  let shopDiv = document.getElementById("shop");
  let libraryBtn = document.getElementById("libraryBtn");
  let libraryDiv = document.getElementById("library");
  let fishListDiv = document.getElementById("fishList");
  let currentLureDisplay = document.getElementById("currentLureDisplay");
  let libraryCount = document.createElement("div");
  libraryCount.id = "libraryCount";
  libraryDiv.insertBefore(libraryCount, fishListDiv);

  let caughtFishSet = new Set();

  function updateCoins() {
    coinsDisplay.textContent = `Coins: ${coins}`;
  }

  function updateCurrentLureDisplay() {
    const lure = lures[currentLureIndex];
    let rarityText = "";
    if (lure.maxRarity === 2) rarityText = "(Common & Uncommon only)";
    else if (lure.maxRarity === 3) rarityText = "(Up to Rare)";
    else if (lure.maxRarity === 4) rarityText = "(Up to Epic)";
    else if (lure.maxRarity === 5) rarityText = "(Up to Legendary)";
    else if (lure.maxRarity === 6) rarityText = "(Up to Exotic)";
    currentLureDisplay.textContent = `Current Lure: ${lure.name} ${rarityText}`;
  }

  function updateShop() {
    shopDiv.innerHTML = "";
    lures.forEach((lure, i) => {
      const owned = ownedLures.has(i);
      const isCurrent = currentLureIndex === i;
      const btn = document.createElement("button");
      if (owned) {
        btn.textContent = isCurrent ? `Selected` : `Select`;
        btn.disabled = isCurrent;
        btn.onclick = () => {
          if (!isCurrent) {
            currentLureIndex = i;
            updateCurrentLureDisplay();
            updateShop();
            info.textContent = `Selected ${lure.name}`;
          }
        };
      } else {
        btn.textContent = `Buy (${lure.cost} coins)`;
        btn.disabled = coins < lure.cost;
        btn.onclick = () => {
          if (coins >= lure.cost) {
            coins -= lure.cost;
            ownedLures.add(i);
            currentLureIndex = i;
            updateCoins();
            updateCurrentLureDisplay();
            updateShop();
            info.textContent = `Bought and selected ${lure.name}`;
          }
        };
      }
      shopDiv.appendChild(btn);
    });
  }

  // Weighted random fish within max rarity
  function getRandomFish() {
    const maxRarity = lures[currentLureIndex].maxRarity;
    let filteredFish = fishTypes.filter(f => f.rarity <= maxRarity);
    let weights = filteredFish.map(f => Math.pow(f.rarity, 2));
    let totalWeight = weights.reduce((a,b) => a + b, 0);
    let rand = Math.random() * totalWeight;
    let cumWeight = 0;
    for(let i=0; i<filteredFish.length; i++) {
      cumWeight += weights[i];
      if (rand <= cumWeight) return filteredFish[i];
    }
    return filteredFish[0];
  }

  function getFishWeight(rarity) {
    let base = rarity * 2;
    return (base + Math.random() * base).toFixed(2);
  }

  let arrowPos = 0;
  let direction = 1;
  let arrowSpeed = 2;

  function startReeling() {
    slideBar.style.display = "block";
    castBtn.disabled = true;
    info.textContent = "Tap the red bar when the green arrow is inside!";
    arrowPos = 0;
    direction = 1;
    caughtFishDiv.textContent = "";
    slideInterval = setInterval(() => {
      arrowPos += direction * arrowSpeed;
      if (arrowPos > 100) {
        arrowPos = 100;
        direction = -1;
      } else if (arrowPos < 0) {
        arrowPos = 0;
        direction = 1;
      }
      greenArrow.style.left = arrowPos + "%";
    }, 20);
  }

  function stopReeling() {
    clearInterval(slideInterval);
    slideInterval = null;
    slideBar.style.display = "none";
    castBtn.disabled = false;
  }

  function isInRedZone(posPercent) {
    return posPercent >= 40 && posPercent <= 60;
  }

  function reelTap() {
    if (!slideInterval) return;
    if (isInRedZone(arrowPos)) {
      stopReeling();
      let fish = getRandomFish();
      let weight = getFishWeight(fish.rarity);
      let value = Math.floor(weight * fish.baseValue);
      coins += value;
      updateCoins();

      let fishIndex = fishTypes.findIndex(f => f.name === fish.name);
      caughtFishSet.add(fishIndex);
      updateLibrary();

      caughtFishDiv.innerHTML = `You caught a <strong class="rarity${fish.rarity}">${fish.name}</strong>!<br>Weight: ${weight} lbs<br>Rarity: ${rarityNames[fish.rarity-1]}<br>Sold for ${value} coins!`;
      info.textContent = "";
      updateShop();
    } else {
      stopReeling();
      caughtFishDiv.textContent = "The fish got away...";
      info.textContent = "";
    }
  }

  castBtn.onclick = () => {
    startReeling();
  };

  slideBar.onclick = () => {
    reelTap();
  };

  libraryBtn.onclick = () => {
    if (libraryDiv.style.display === "none") {
      libraryDiv.style.display = "block";
      libraryBtn.textContent = "Hide Fish Library";
      updateLibrary();
    } else {
      libraryDiv.style.display = "none";
      libraryBtn.textContent = "Show Fish Library";
    }
  };

  function updateLibrary() {
    fishListDiv.innerHTML = "";
    libraryCount.textContent = `Caught ${caughtFishSet.size} / ${fishTypes.length} fish`;
    fishTypes.forEach((fish, i) => {
      const caught = caughtFishSet.has(i);
      const div = document.createElement("div");
      div.classList.add("fishEntry");
      div.classList.add(`rarity${fish.rarity}`);
      if (!caught) div.classList.add("locked");
      div.innerHTML = `<span>${fish.name}</span><span>${caught ? rarityNames[fish.rarity-1] : "Locked"}</span>`;
      fishListDiv.appendChild(div);
    });
  }

  updateCoins();
  updateShop();
  updateCurrentLureDisplay();
</script>
</body>
</html>
